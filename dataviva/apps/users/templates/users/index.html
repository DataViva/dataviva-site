{% extends "_base.html" %}

{% block index_content %}
<div class="institucional search">
    <h2>{% trans %}Users{% endtrans %}</h2>
        
    <div class="meta">
        <table id="usersTable" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th>{% trans %}User ID{% endtrans %}<i class="fa fa-fw fa-sort"></i></th>
                    <th>{% trans %}Name{% endtrans %}<i class="fa fa-fw fa-sort"></i></th>
                    <th>{% trans %}Email{% endtrans %}<i class="fa fa-fw fa-sort"></i></th>
                    <th>{% trans %}Administrators{% endtrans %}<input name="select_all" value="1" id="select-all" type="checkbox"/> </th>
                </tr>
            </thead>
        </table>
    </div>
</div>

<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

<script type="text/javascript">
    
    var Admin = function() {
         this.table = $('#usersTable').DataTable( {
                "sAjaxSource": "/users/all",
                "sAjaxDataProp": "users",
                "aoColumnsDefs": [
                    { "data": "id" },
                    { "data": "title" },
                    { "data": "authors" },
                    { "data": "role"},
                ],
                "columnDefs": [ {
                    'className' : 'body-checkbox',
                    'targets':   3,
                    'render': function(data, type,users, meta){
                        if(data){
                            return '<input type="checkbox" name="checkboxAdmin" value="'+users[0]+'" checked>'
                        }else{
                            return '<input type="checkbox" name="checkboxAdmin" value="'+users[0]+'">'
                        }
                    }
                } ],
                "columns": [
                   { "width": "10%" },
                   { "width": "30%" },
                   null,
                   { "width": "19%" },
                 ],              
               "paging": false,
               "bFilter": false,
               "info": false //number of rows in footer table
            });

    };
            

    Admin.prototype.singleCheckbox = function(){
        //Single Checkbox
        $('#usersTable tbody').on('click','.body-checkbox', function () {
            var admin = {};
            admin[this.firstElementChild.value] = this.firstElementChild.checked;
            sendChecks(admin);
        });
    };

    Admin.prototype.multipleCheckbox = function(){
            //Multiple Checkbox
        $('#usersTable thead').on('click','#select-all', function () {
            var admin = {};
            $('input[name="checkboxAdmin"]').each(function() {
                admin[this.value] = this.checked;
            });
            sendChecks(admin);
        });
    };

    Admin.prototype.controlCheckbox = function(usersTable){
            // Select all control
        $('#select-all').on('click', function(){
           var rows = table.rows({ 'search': 'applied' }).nodes();
           $('input[type="checkbox"]', rows).prop('checked', this.checked);
        });

        $('#usersTable tbody').on('change', 'input[type="checkbox"]', function(){
           if(!this.checked){
              var el = $('#select-all').get(0);
              if(el && el.checked && ('indeterminate' in el)){
                 el.indeterminate = true;
                }
            }
        });
    };

    var admin = new Admin();
    admin.singleCheckbox();
    admin.multipleCheckbox();
    admin.controlCheckbox(usersTable);

    //Verify Checks
    function sendChecks(admin){
        var lang = $('html').attr('lang');
        $.ajax({
          method: "POST",
          url: "/"+lang+"/users/users/",
          data: admin,
          success: function (msg) {
                $.notify({
                    message: msg,
                },{
                    offset: {
                            x: window.innerWidth * 18 / 100,
                            y: window.innerHeight * 25 / 100
                    },
                    type: 'success',
                    z_index: 1031,
                    delay: 5000,
                    timer: 1000
                });
          }
        })
    }


</script>

{% endblock index_content %}